<html lang="en">
<head>
<title>New kinds of Numbers - GNU Smalltalk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Smalltalk User's Guide">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="More-subclassing.html#More-subclassing" title="More subclassing">
<link rel="prev" href="Playing-with-Arrays.html#Playing-with-Arrays" title="Playing with Arrays">
<link rel="next" href="Inheritance-and-Polymorphism.html#Inheritance-and-Polymorphism" title="Inheritance and Polymorphism">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with no Front-Cover Texts,
     and with no Back-Cover Texts.  A copy of the license is included
     in the section entitled ``GNU Free Documentation License''.
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="New-kinds-of-Numbers"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Inheritance-and-Polymorphism.html#Inheritance-and-Polymorphism">Inheritance and Polymorphism</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Playing-with-Arrays.html#Playing-with-Arrays">Playing with Arrays</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="More-subclassing.html#More-subclassing">More subclassing</a>
<hr>
</div>

<h4 class="subsection">6.9.3 Adding a New Kind of Number</h4>

<p>If we were programming an application which did a large
amount of complex math, we could probably manage it with a
number of two-element arrays.  But we'd forever be writing
in-line code for the math and comparisons; it would be much
easier to just implement an object class to support the complex
numeric type.  Where in the class hierarchy would it be
placed?

   <p>You've probably already guessed&mdash;but let's step down the
hierarchy anyway.  Everything inherits from Object, so
that's a safe starting point.  Complex numbers can not be
compared with <code>&lt;</code> and <code>&gt;</code>, and yet we strongly suspect that,
since they are numbers, we should place them under the Number
class.  But Number inherits from Magnitude&mdash;how do we
resolve this conflict?  A subclass can place itself under a
superclass which allows some operations the subclass doesn't
wish to allow.  All that you must do is make sure you intercept
these messages and return an error.  So we will place
our new Complex class under Number, and make sure to disallow
comparisons.

   <p>One can reasonably ask whether the real and imaginary
parts of our complex number will be integer or floating
point.  In the grand Smalltalk tradition, we'll just leave
them as objects, and hope that they respond to numeric messages
reasonably.  If they don't, the user will doubtless
receive errors and be able to track back their mistake with
little fuss.

   <p>We'll define the four basic math operators, as well as
the (illegal) relationals.  We'll add <code>printOn:</code> so that the
printing methods work, and that should give us our Complex
class.  The class as presented suffers some limitations,
which we'll cover later in the chapter.

<pre class="example">        Number subclass: Complex [
            | realpart imagpart |
     
            "This is a quick way to define class-side methods."
            Complex class &gt;&gt; new [
                &lt;category: 'instance creation'&gt;
                ^self error: 'use real:imaginary:'
            ]
            Complex class &gt;&gt; new: ignore [
                &lt;category: 'instance creation'&gt;
                ^self new
            ]
            Complex class &gt;&gt; real: r imaginary: i [
                &lt;category: 'instance creation'&gt;
                ^(super new) setReal: r setImag: i
            ]
     
            setReal: r setImag: i [
                &lt;category: 'basic'&gt;
                realpart := r.
                imagpart := i.
                ^self
            ]
     
            real [
                &lt;category: 'basic'&gt;
                ^realpart
            ]
            imaginary [
                &lt;category: 'basic'&gt;
                ^imagpart
            ]
     
            + val [
                &lt;category: 'math'&gt;
                ^Complex real: (realpart + val real)
                    imaginary: (imagpart + val imaginary)
            ]
            - val [
                &lt;category: 'math'&gt;
                ^Complex real: (realpart - val real)
                    imaginary: (imagpart - val imaginary)
            ]
            * val [
                &lt;category: 'math'&gt;
                ^Complex real: (realpart * val real) - (imagpart * val imaginary)
                    imaginary: (imagpart * val real) + (realpart * val imaginary)
            ]
            / val [
                &lt;category: 'math'&gt;
                | d r i |
                d := (val real * val real) + (val imaginary * val imaginary).
                r := ((realpart * val real) + (imagpart * val imaginary)).
                i := ((imagpart * val real) - (realpart * val imaginary)).
                ^Complex real: r / d imaginary: i / d
            ]
     
            = val [
                &lt;category: 'comparison'&gt;
                ^(realpart = val real) &amp; (imagpart = val imaginary)
            ]
     
            "All other comparison methods are based on &lt;"
            &lt; val [
                &lt;category: 'comparison'&gt;
                ^self shouldNotImplement
            ]
     
            printOn: aStream [
                &lt;category: 'printing'&gt;
                realpart printOn: aStream.
                aStream nextPut: $+.
                imagpart printOn: aStream.
                aStream nextPut: $i
            ]
        ]
</pre>
   <p>There should be surprisingly little which is actually
new in this example.  The printing method uses both <code>printOn:</code>
as well as <code>nextPut:</code> to do its printing.  While we haven't
covered it, it's pretty clear that <code>$+</code> generates the ASCII
character <code>+</code> as an object<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>, and <code>nextPut:</code> puts its argument
as the next thing on the stream.

   <p>The math operations all generate a new object, calculating
the real and imaginary parts, and invoking the Complex
class to create the new object.  Our creation code is a
little more compact than earlier examples; instead of using
a local variable to name the newly-created object, we just
use the return value and send a message directly to the new
object.  Our initialization code explicitly returns self;
what would happen if we left this off?

   <div class="footnote">
<hr>
<h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> A <span class="sc">gnu</span> Smalltalk extension
  allows you to type characters by ASCII code too, as in
  <code>$&lt;43&gt;</code>.</p>

   <p><hr></div>

   </body></html>

