<html lang="en">
<head>
<title>Handler stack unwinding caveat - GNU Smalltalk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Smalltalk User's Guide">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Exception-handling.html#Exception-handling" title="Exception handling">
<link rel="prev" href="Hooking-into-the-stack-unwinding.html#Hooking-into-the-stack-unwinding" title="Hooking into the stack unwinding">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with no Front-Cover Texts,
     and with no Back-Cover Texts.  A copy of the license is included
     in the section entitled ``GNU Free Documentation License''.
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Handler-stack-unwinding-caveat"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Hooking-into-the-stack-unwinding.html#Hooking-into-the-stack-unwinding">Hooking into the stack unwinding</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Exception-handling.html#Exception-handling">Exception handling</a>
<hr>
</div>

<h4 class="subsection">6.11.7 Handler stack unwinding caveat</h4>

<p>One important difference between Smalltalk and other languages is
that when a handler is invoked, the stack is not unwound. 
The Smalltalk exception system is designed this way because it's rare
to write code that could break because of this difference, and the
<code>#resume:</code> feature doesn't make sense if the stack is unwound. 
It is easy enough to unwind a stack later, and is not so easy to wind
it again if done too early.

   <p>For almost all applications, this will not matter, but it technically
changes the semantics significantly so should be kept in mind.  One
important case in which it might matter is when using <code>#ensure:</code>
blocks <em>and</em> exception handlers.  For comparison, this Smalltalk
code:

<pre class="example">     | n |
     n := 42.
     [[self error: 'error'] ensure: [n := 24]]
         on: Error
         do: [:sig | n printNl. sig return].
     n printNl.
</pre>
   <p class="noindent">will put "42" followed by "24" on the transcript, because the <code>n :=
24</code> will not be executed until <code>sig return</code> is invoked, unwinding
the stack.  Similar Java code acts differently:

<pre class="example">     int n = 42;
     try
       {
         try {throw new Exception ("42");}
         finally {n = 24;}
       }
     catch (Exception e)
       {
         System.out.println (n);
       }
     System.out.println (n);
</pre>
   <p class="noindent">printing "24" twice, because the stack unwinds before executing the
catch block.

   </body></html>

