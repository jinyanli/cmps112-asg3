<html lang="en">
<head>
<title>Nested calls - GNU Smalltalk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Smalltalk User's Guide">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Debugging.html#Debugging" title="Debugging">
<link rel="prev" href="Simple-errors.html#Simple-errors" title="Simple errors">
<link rel="next" href="Looking-at-objects.html#Looking-at-objects" title="Looking at objects">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with no Front-Cover Texts,
     and with no Back-Cover Texts.  A copy of the license is included
     in the section entitled ``GNU Free Documentation License''.
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Nested-calls"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Looking-at-objects.html#Looking-at-objects">Looking at objects</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Simple-errors.html#Simple-errors">Simple errors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Debugging.html#Debugging">Debugging</a>
<hr>
</div>

<h4 class="subsection">6.8.2 Nested Calls</h4>

<p>Type the following lines:
<pre class="example">        x := Dictionary new
        x at: 1
</pre>
   <p>The error you receive will look like:
<pre class="example">        Dictionary new: 31 "&lt;0x33788&gt;" error: key not found
        <span class="roman">...blah blah...</span>
        Dictionary&gt;&gt;#error:
        [] in Dictionary&gt;&gt;#at:
        [] in Dictionary&gt;&gt;#at:ifAbsent:
        Dictionary(HashedCollection)&gt;&gt;#findIndex:ifAbsent:
        Dictionary&gt;&gt;#at:ifAbsent:
        Dictionary&gt;&gt;#at:
        UndefinedObject(Object)&gt;&gt;#executeStatements
</pre>
   <p>The error itself is pretty clear; we asked for something
within the Dictionary which wasn't there.  The object
which had the error is identified as <code>Dictionary new: 31</code>. 
A Dictionary's default size is 31; thus, this is the object
we created with <code>Dictionary new</code>.

   <p>The stack backtrace shows us the inner structure of how
a Dictionary responds to the <code>#at:</code> message.  Our hand-entered
command causes the usual entry for <code>UndefinedObject(Object)</code>. 
Then we see a Dictionary object responding to an <code>#at:</code> message
(the &ldquo;Dictionary&gt;&gt;#at:&rdquo; line).  This code called the object
with an <code>#at:ifAbsent:</code> message.  All of a sudden,
Dictionary calls that strange method <code>#findIndex:ifAbsent:</code>,
which evaluates two blocks, and then the error happens.

   <p>To understand this better, it is necessary to know that
a very common way to handle errors in Smalltalk is to
hand down a block of code which will be called when an error
occurs.  For the Dictionary code, the <code>at:</code> message passes
in a block of code to the at:ifAbsent: code to be called
when <code>at:ifAbsent:</code> can't find the given key, and
<code>at:ifAbsent:</code> does the same with <code>findIndex:ifAbsent:</code>. 
Thus, without even looking at the code for Dictionary itself, we can
guess something of the code for Dictionary's implementation:

<pre class="example">        findIndex: key ifAbsent: errCodeBlock [
            <span class="roman">...look for key...</span>
            (keyNotFound) ifTrue: [ ^(errCodeBlock value) ]
            <span class="roman">...</span>
        ]
     
        at: key [
            ^self at: key ifAbsent: [^self error: 'key not found']
        ]
</pre>
   <p>Actually, <code>findIndex:ifAbsent:</code> lies in class <code>HashedCollection</code>,
as that <code>Dictionary(HashedCollection)</code> in the backtrace says.

   <p>It would be nice if each entry on the stack backtrace included
source line numbers.  Unfortunately, at this point <span class="sc">gnu</span> Smalltalk doesn't
provide this feature.  Of course, you have the source code
available...

   </body></html>

