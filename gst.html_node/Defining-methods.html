<html lang="en">
<head>
<title>Defining methods - GNU Smalltalk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Smalltalk User's Guide">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Creating-classes.html#Creating-classes" title="Creating classes">
<link rel="prev" href="Documenting-the-class.html#Documenting-the-class" title="Documenting the class">
<link rel="next" href="Instance-methods.html#Instance-methods" title="Instance methods">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with no Front-Cover Texts,
     and with no Back-Cover Texts.  A copy of the license is included
     in the section entitled ``GNU Free Documentation License''.
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Defining-methods"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Instance-methods.html#Instance-methods">Instance methods</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Documenting-the-class.html#Documenting-the-class">Documenting the class</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Creating-classes.html#Creating-classes">Creating classes</a>
<hr>
</div>

<h4 class="subsection">6.4.3 Defining a method for the class</h4>

<p>We have created a class, but it isn't ready to do any
work for us&mdash;we have to define some messages which the class
can process first.  We'll start at the beginning by defining
methods for instance creation:
<pre class="example">         Account class extend [
            new [
                | r |
                &lt;category: 'instance creation'&gt;
                r := super new.
                r init.
                ^r
           ]
        ]
</pre>
   <p>The important points about this are:

     <ul>
<li><code>Account class</code> means that we are defining messages which are
to be sent to the Account class itself.

     <li><code>&lt;category: 'instance creation'&gt;</code>
is more documentation support; it says that the methods
we are defining supports creating objects of type
Account.

     <li>The text starting with <code>new [</code> and ending with <code>]</code>
defined what action to take for the message <code>new</code>. 
When you enter this definition, <span class="sc">gnu</span> Smalltalk will simply
give you another prompt, but your method has been compiled in
and is ready for use.  <span class="sc">gnu</span> Smalltalk is pretty quiet on successful
method definitions&mdash;but you'll get plenty of error
messages if there's a problem!

     <p>If you're familiar with other Smalltalks, note that the body
of the method is always in brackets. 
</ul>

   <p>The best way to describe how this method works is to
step through it.  Imagine we sent a message to the new class
Account with the command line:
<pre class="example">        Account new
</pre>
   <p><code>Account</code> receives the message <code>new</code> and looks up
how to process this message.  It finds our new definition, and
starts running it.  The first line, <code>| r |</code>, creates a local
variable named <code>r</code> which can be used as a placeholder for
the objects we create.  <code>r</code> will go away as soon as the message
is done being processed; note the parallel with <code>balance</code>, which
goes away as soon as the object is not used anymore.  And note that
here you have to declare local variables explicitly, unlike what
you did in previous examples.

   <p>The first real step is to actually create the object. 
The line <code>r := super new</code> does this using a fancy trick. 
The word <code>super</code> stands for the same object that the message
<code>new</code> was originally sent to (remember?  it's <code>Account</code>),
except that when Smalltalk goes to search for the methods,
it starts one level higher up in the hierarchy than the current
level.  So for a method in the Account class, this is
the Object class (because the class Account inherits from is
Object&mdash;go back and look at how we created the Account
class), and the Object class' methods then execute some code
in response to the <code>#new</code> message.  As it turns out, Object
will do the actual creation of the object when sent a <code>#new</code>
message.

   <p>One more time in slow motion: the Account method <code>#new</code>
wants to do some fiddling about when new objects are created,
but he also wants to let his parent do some work with
a method of the same name.  By saying <code>r := super new</code> he
is letting his parent create the object, and then he is attaching
it to the variable <code>r</code>.  So after this line of code executes,
we have a brand new object of type Account, and <code>r</code>
is bound to it.  You will understand this better as time
goes on, but for now scratch your head once, accept it as a
recipe, and keep going.

   <p>We have the new object, but we haven't set it up correctly. 
Remember the hidden variable <code>balance</code> which we saw
in the beginning of this chapter?  <code>super new</code> gives us the
object with the <code>balance</code> field containing nothing, but we want
our balance field to start at 0.  <a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>

   <p>So what we need to do is ask the object to set itself up. 
By saying <code>r init</code>, we are sending the <code>init</code>
message to our new Account.  We'll define
this method in the next section&mdash;for now just assume that
sending the <code>init</code> message will get our Account set up.

   <p>Finally, we say <code>^r</code>.  In English, this is <i>return what
r is attached to</i>.  This means that whoever sent to Account
the <code>new</code> message will get back this brand new account.  At
the same time, our temporary variable <code>r</code> ceases to exist.

   <div class="footnote">
<hr>
<h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> And unlike C, Smalltalk
draws a distinction between <code>0</code> and <code>nil</code>.  <code>nil</code>
is the <i>nothing</i> object, and you will receive an error if you
try to do, say, math on it.  It really does matter that we
initialize our instance variable to the number 0 if we wish
to do math on it in the future.</p>

   <p><hr></div>

   </body></html>

